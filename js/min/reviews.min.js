$(function(){Parse.$=jQuery,Parse.initialize("t0PIynmyht1hN0ORLTYPKKL8OFVuAVYFbzd25V12","BhGFfHKdLl4mL0lc1AFmv43aWknXc1fbTDSYt1Jg");var e=Parse.Object.extend("Categories"),t=(Parse.Object.extend("Ratings"),Parse.Object.extend("Products")),i=Parse.Collection.extend({model:e}),n=Parse.Collection.extend({model:t}),s=new n,r=Parse.View.extend({el:"#main-content",initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#home-content-template").html())),new V,new P,new y,new x}}),l=Parse.View.extend({el:"#main-content",initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#logged-in-content-template").html())),new P,new x,new y}}),a=Parse.View.extend({el:"#main-content",initialize:function(){var e=this;this.ratingsViewActive=!1,e.render()},render:function(){this.$el.html(_.template($("#add-business-form-content-template").html())),new o,new y}}),o=Parse.View.extend({el:"#add-business-component",events:{"click .add-rating-checkbox":"displayAddRatingForm","click  #add-business-submit":"createBusiness"},initialize:function(){var e=this;_.bindAll(this,"displayAddRatingForm","createBusiness"),e.render()},render:function(){this.$el.html(_.template($("#add-business-template").html()));var e=new i,t=new i,n=new i,s=new L({el:$("#topCategories"),collection:e,topLevel:!0}),r=new L({el:$("#subCategories"),collection:t});r.setHidden(!0);var l=new L({el:$("#subSubCategories"),collection:n});l.setHidden(!0),s.childView=r,r.childView=l},displayAddRatingForm:function(){this.ratingsViewActive?(this.addRatingView.remove(),this.ratingsViewActive=!1):(this.addRatingView=new d({el:$("#rating-form")}),this.ratingsViewActive=!0)},createBusiness:function(){var i=new t;i.ACL=new Parse.ACL(Parse.User.current());var n=i.relation("Categories"),r=new e;$("#subSubCategories").val()&&"Select One"!==$("#subSubCategories").val()?r.id=$("#subSubCategories").val():$("#subCategories").val()&&"Select One"!==$("#subCategories").val()?r.id=$("#subCategories").val():$("#topCategories").val()&&"Select One"!==$("#topCategories").val()&&(r.id=$("#topCategories").val());var l="";$("#name").val()?i.set("name",$("#name").val()):l+="<li>Name required</li>",r.id?n.add(r):l+="<li>Category required</li>",$("#url").val()?i.set("url",$("#url").val()):l+="<li>Website required</li>",i.set("description",$("#description").val()),""!==l?($(".error").html("<ul>"+l+"</ul>"),$(".error").show()):($(".error").hide(),i.save(null,{success:function(e){console.log("Success! "+e.id),s.add(e),E.mainView.viewBusiness(e,!0)},error:function(e,t){console.log("Failed to create new object, with error code: "+t.description),$(".error").html(t).show()}}))}}),d=Parse.View.extend({initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#add-rating-template").html()))}}),c=Parse.View.extend({el:".content",events:{"click .log-out":"logOut","click .login-link":"displayLogin","click .signup-link":"displaySignup","click #add-business-button":"displayAddBusinessForm"},initialize:function(){var e=this;return e.render(),e},displayLogin:function(){new C,this.undelegateEvents(),delete this},displaySignup:function(){new S,this.undelegateEvents(),delete this},displayAddBusinessForm:function(e){Parse.User.current()?this.contentView=new a:this.displaySignup(e)},viewBusiness:function(e,t){this.contentView=new h({model:e},t)},render:function(){this.$el.html(_.template($("#main-template").html())),new I,Parse.User.current()?(new A,this.contentView=new l):(new z,this.contentView=new r)},remove:function(){return $(this.el).empty().detach(),this},logOut:function(){Parse.User.logOut(),this.render()}}),h=Parse.View.extend({el:"#main-content",initialize:function(){var e=this;e.render()},template:function(){},render:function(){var e=this.model,t=(e.get("description"),_.template($("#business-page-template").html()));this.$el.html(t),this.isUpdated?$(".success").text("You did it biatch!"):$(".success").hide(),new u({model:e}),new m,new g,new w,new p,new f,new v}}),u=Parse.View.extend({el:"#businessInfoSection",initialize:function(){var e=this;e.render()},render:function(){var e=this.model,t=e.get("url"),i=e.get("name"),n=e.get("description"),s=_.template($("#business-info-template").html(),{name:i,url:t,description:n});this.$el.html(s),b(e,"#topCategory","#subCategory","#subSubCategory")}}),m=Parse.View.extend({el:"#businessLogoSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#business-logo-template").html(),{});this.$el.html(e)}}),g=Parse.View.extend({el:"#dealsSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#deals-template").html(),{});this.$el.html(e)}}),w=Parse.View.extend({el:"#leftAdSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#left-ad-template").html(),{});this.$el.html(e)}}),p=Parse.View.extend({el:"#reviewsSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#reviews-template").html(),{});this.$el.html(e)}}),f=Parse.View.extend({el:"#rightEncourageSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#right-encourage-template").html(),{});this.$el.html(e)}}),v=Parse.View.extend({el:"#rightAdSection",initialize:function(){var e=this;e.render()},render:function(){var e=_.template($("#right-ad-template").html(),{});this.$el.html(e)}}),b=function(e,t,i,n){var s=e.relation("Categories");s.query().first({success:function(e){$(n).html(e.get("name"));var s=e.get("Parent");s&&s.fetch({success:function(e){var n=e.get("parent");n&&n.fetch({success:function(e){$(t).html(e.get("name")+" > ")}}),$(i).html(e.get("name")+" > ")},error:function(e,t){console.log(t)}})}})},V=Parse.View.extend({el:"#call-to-action",initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#call-to-action-template").html()))}}),P=Parse.View.extend({el:"#best-of-per-category",initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#best-of-per-category-template").html()))}}),y=Parse.View.extend({el:"#blog",initialize:function(){var e=this;e.render()},render:function(){this.$el.html(_.template($("#blog-template").html()))}}),x=Parse.View.extend({el:"#add-business-prompt",initialize:function(){this.render()},remove:function(){return $(this.el).empty().detach(),this},render:function(){this.$el.html(_.template($("#add-business-prompt-template").html())),this.delegateEvents()}}),z=Parse.View.extend({el:"#nav-login-signup",initialize:function(){this.render()},render:function(){this.$el.html(_.template($("#not-logged-in-nav-template").html()))}}),A=Parse.View.extend({el:"#nav-login-signup",initialize:function(){this.render()},render:function(){this.$el.html(_.template($("#logged-in-nav-template").html()))}}),C=Parse.View.extend({events:{"submit form.login-form":"logIn","click #signup-from-login":"displaySignup"},el:".content",initialize:function(){_.bindAll(this,"logIn"),this.render()},logIn:function(){var e=this,t=this.$("#login-username").val(),i=this.$("#login-password").val();return Parse.User.logIn(t,i,{success:function(){new c,e.undelegateEvents(),delete e},error:function(){e.$(".login-form .error").html("Invalid username or password. Please try again.").show(),this.$(".login-form button").removeAttr("disabled")}}),this.$(".login-form button").attr("disabled","disabled"),!1},remove:function(){return $(this.el).empty().detach(),this},render:function(){this.$el.html(_.template($("#login-template").html())),this.delegateEvents()},displaySignup:function(){new S,this.undelegateEvents(),delete this}}),S=Parse.View.extend({events:{"submit form.signup-form":"signUp","click #login-from-signup-button":"displayLogin"},el:".content",initialize:function(){_.bindAll(this,"signUp"),this.render()},signUp:function(){var e=this,t=this.$("#signup-username").val(),i=this.$("#signup-password").val();return Parse.User.signUp(t,i,{ACL:new Parse.ACL},{success:function(){new c,e.undelegateEvents(),delete e},error:function(t,i){e.$(".signup-form .error").html(i.message).show(),this.$(".signup-form button").removeAttr("disabled")}}),this.$(".signup-form button").attr("disabled","disabled"),!1},remove:function(){return $(this.el).empty().detach(),this},render:function(){this.$el.html(_.template($("#signup-template").html())),this.delegateEvents()},displayLogin:function(){new C,this.undelegateEvents(),delete this}}),I=Parse.View.extend({el:"#nav-search",initialize:function(){var e=this;e.render()},remove:function(){return $(this.el).empty().detach(),this},render:function(){this.$el.html(_.template($("#home-nav-search-template").html()))}}),e=Parse.Object.extend("Categories"),i=Parse.Collection.extend({model:e}),O=Parse.View.extend({tagName:"option",initialize:function(){_.bindAll(this,"render")},render:function(){return $(this.el).attr("value",this.model.id).html(this.model.get("name")),this}}),L=Parse.View.extend({events:{change:"changeSelected"},initialize:function(){_.bindAll(this,"addOne","addAll"),this.categories=new i,this.categories.bind("add",this.addOne),this.categories.bind("reset",this.addAll),this.categories.bind("all",this.render);var t=new Parse.Query(e);if(this.parentId){var n=new e;n.id=this.parentId,t.equalTo("Parent",n)}else t.doesNotExist("Parent");t.ascending("name"),this.categories.query=t,this.categories.fetch()},addOne:function(e){var t=new O({model:e});this.categoryViews.push(t),$(this.el).append(t.render().el)},addAll:function(){_.each(this.categoryViews,function(e){e.remove()}),this.categoryViews=[],this.categories.each(this.addOne),this.selectedId&&$(this.el).val(this.selectedId)},changeSelected:function(){this.setSelectedId($(this.el).val())},setDisabled:function(e){$(this.el).attr("disabled",e)},setHidden:function(e){e?$(this.el).hide():$(this.el).show()},setParentId:function(t){var i=this;if(this.parentId=t,this.parentId||this.topLevel){if(!this.topLevel){var n=new e;n.id=this.parentId,this.categories.query.equalTo("Parent",n),this.categories.fetch({success:function(e){0===e.length?i.setHidden(!0):i.setHidden(!1)}}),"undefined"!=typeof this.childView&&"undefined"!=typeof this.childView.childView&&(this.childView.childView.categories.reset(),this.childView.childView.setHidden(!0)),this.render()}}else this.setHidden(!0)},setSelectedId:function(e){this.childView&&(this.childView.selectedId=null,this.childView.setParentId(e),this.childView.childView&&(this.childView.childView.categories.reset(),this.childView.childView.setHidden(!0)))}}),B=Parse.Object.extend("AppState",{defaults:{}}),k=Parse.View.extend({el:$("#mainapp"),initialize:function(){this.render()},render:function(){this.mainView=new c}}),U=Parse.Router.extend({routes:{"business/add":"addBusiness","business/:id":"viewBusiness","#":"mainView",home:"mainView"},initialize:function(){},addBusiness:function(){E.mainView.displayAddBusinessForm()},viewBusiness:function(e){var i=new Parse.Query(t);i.get(e,{success:function(e){E.mainView.viewBusiness(e,!1)},error:function(e,t){console.log("Unable to find product: "+t.description)}})},mainView:function(){typeof E.mainView!==c&&(E.mainView=new c)}}),E=(new B,new U,new k);Parse.history.start()});